# Requirements Document - Voice Calls & Screen Share

## Introduction

Расширение P2P мессенджера функциями голосовых звонков и демонстрации экрана. Пользователи смогут совершать голосовые звонки друг другу через WebRTC, управлять микрофоном и делиться экраном во время звонка.

## Glossary

- **Voice Call**: Голосовой звонок между двумя пользователями через WebRTC
- **Screen Share**: Демонстрация экрана одного пользователя другому
- **Call Controls**: Элементы управления звонком (микрофон, демонстрация экрана, завершение)
- **Incoming Call Modal**: Модальное окно с входящим звонком
- **Audio Stream**: Аудио поток от микрофона пользователя

## Requirements

### Requirement 1

**User Story:** Как пользователь, я хочу инициировать голосовой звонок с собеседником, чтобы общаться голосом

#### Acceptance Criteria

1. THE P2P-Messenger SHALL отображать кнопку "Позвонить" в интерфейсе активного чата
2. WHEN пользователь нажимает кнопку "Позвонить", THEN THE P2P-Messenger SHALL отправить сигнал вызова собеседнику
3. WHEN вызов отправлен, THEN THE P2P-Messenger SHALL отобразить экран ожидания ответа
4. WHEN собеседник принимает вызов, THEN THE P2P-Messenger SHALL установить аудио соединение через WebRTC
5. WHEN собеседник отклоняет вызов, THEN THE P2P-Messenger SHALL отобразить уведомление об отклонении

### Requirement 2

**User Story:** Как пользователь, я хочу принимать или отклонять входящие звонки, чтобы контролировать когда я общаюсь

#### Acceptance Criteria

1. WHEN получен входящий звонок, THEN THE P2P-Messenger SHALL отобразить модальное окно с информацией о звонящем
2. THE P2P-Messenger SHALL предоставить кнопку "Принять" в модальном окне входящего звонка
3. THE P2P-Messenger SHALL предоставить кнопку "Отклонить" в модальном окне входящего звонка
4. WHEN пользователь нажимает "Принять", THEN THE P2P-Messenger SHALL установить аудио соединение
5. WHEN пользователь нажимает "Отклонить", THEN THE P2P-Messenger SHALL отправить сигнал отклонения звонящему

### Requirement 3

**User Story:** Как пользователь, я хочу управлять микрофоном во время звонка, чтобы контролировать когда меня слышно

#### Acceptance Criteria

1. WHEN звонок активен, THEN THE P2P-Messenger SHALL отображать кнопку управления микрофоном
2. THE P2P-Messenger SHALL включать микрофон по умолчанию при начале звонка
3. WHEN пользователь нажимает кнопку микрофона, THEN THE P2P-Messenger SHALL переключать состояние микрофона (вкл/выкл)
4. WHEN микрофон выключен, THEN THE P2P-Messenger SHALL прекратить передачу аудио потока
5. WHEN микрофон включен, THEN THE P2P-Messenger SHALL возобновить передачу аудио потока

### Requirement 4

**User Story:** Как пользователь, я хочу демонстрировать свой экран собеседнику, чтобы показать что-то на моем компьютере

#### Acceptance Criteria

1. WHEN звонок активен, THEN THE P2P-Messenger SHALL отображать кнопку "Демонстрация экрана"
2. WHEN пользователь нажимает кнопку демонстрации, THEN THE P2P-Messenger SHALL запросить разрешение на захват экрана
3. WHEN разрешение получено, THEN THE P2P-Messenger SHALL начать передачу видео потока экрана собеседнику
4. WHEN демонстрация активна, THEN THE P2P-Messenger SHALL отображать индикатор активной демонстрации
5. WHEN пользователь останавливает демонстрацию, THEN THE P2P-Messenger SHALL прекратить передачу видео потока

### Requirement 5

**User Story:** Как пользователь, я хочу завершать звонок, чтобы закончить разговор

#### Acceptance Criteria

1. WHEN звонок активен, THEN THE P2P-Messenger SHALL отображать кнопку "Завершить звонок"
2. WHEN пользователь нажимает "Завершить звонок", THEN THE P2P-Messenger SHALL закрыть все медиа потоки
3. WHEN звонок завершен, THEN THE P2P-Messenger SHALL отправить сигнал завершения собеседнику
4. WHEN получен сигнал завершения от собеседника, THEN THE P2P-Messenger SHALL закрыть звонок локально
5. WHEN звонок завершен, THEN THE P2P-Messenger SHALL вернуться к интерфейсу чата

### Requirement 6

**User Story:** Как пользователь, я хочу видеть статус звонка, чтобы понимать что происходит

#### Acceptance Criteria

1. WHEN звонок инициирован, THEN THE P2P-Messenger SHALL отображать статус "Вызов..."
2. WHEN звонок установлен, THEN THE P2P-Messenger SHALL отображать таймер длительности звонка
3. WHEN собеседник отключил микрофон, THEN THE P2P-Messenger SHALL отображать индикатор выключенного микрофона
4. WHEN собеседник демонстрирует экран, THEN THE P2P-Messenger SHALL отображать видео поток экрана
5. WHEN звонок завершен, THEN THE P2P-Messenger SHALL отображать длительность завершенного звонка

### Requirement 7

**User Story:** Как пользователь, я хочу слышать звуковые сигналы, чтобы понимать состояние звонка

#### Acceptance Criteria

1. WHEN получен входящий звонок, THEN THE P2P-Messenger SHALL воспроизводить звук входящего вызова
2. WHEN исходящий звонок ожидает ответа, THEN THE P2P-Messenger SHALL воспроизводить звук ожидания
3. WHEN звонок принят, THEN THE P2P-Messenger SHALL остановить звуковые сигналы
4. WHEN звонок отклонен или завершен, THEN THE P2P-Messenger SHALL воспроизвести короткий сигнал
5. THE P2P-Messenger SHALL позволять пользователю отключать звуковые сигналы
